<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Globe with Stars Plugin Test</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
      #controls {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.9);
        padding: 15px;
        border-radius: 5px;
        font-family: Arial, sans-serif;
        z-index: 1;
      }
      #controls label {
        display: block;
        margin-bottom: 5px;
      }
      #controls input[type="range"] {
        width: 200px;
      }
    </style>
        <script src="https://unpkg.com/maplibre-gl@^5.11.0/dist/maplibre-gl.js"></script>
    <link
      href="https://unpkg.com/maplibre-gl@^5.11.0/dist/maplibre-gl.css"
      rel="stylesheet"
    />

    <script src="stars-plugin.js"></script>
  </head>
  <body>
    <div id="map"></div>
    <div id="controls">
      <label>
        Star Intensity: <span id="intensity-value">20.0</span>
        <input
          type="range"
          id="intensity"
          min="0"
          max="50"
          step="0.5"
          value="20"
        />
      </label>
    </div>
    <script>
      const map = new maplibregl.Map({
        container: "map",
        style: {
          version: 8,
          sources: {
            satellite: {
              type: "raster",
              tiles: [
                "https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2020_3857/default/g/{z}/{y}/{x}.jpg",
              ],
              tileSize: 256,
            },
          },
          layers: [
            {
              id: "satellite",
              type: "raster",
              source: "satellite",
            },
          ],
          projection: {
            type: "globe",
          },
        },
        center: [0, 20],
        zoom: 1.5,
        antialias: true,
      });

      let starsPlugin;

      map.on("load", () => {
        // Set sky layer for better visualization
        map.setSky({
          "sky-color": "#080820",
          "horizon-color": "#2a2a3a",
          "atmosphere-blend": 0.8,
        });

        // Add stars plugin
        starsPlugin = new StarsPlugin({
          intensity: 20.0,
          density: 0.35,
        });
        map.addControl(starsPlugin);

        console.log("Map loaded with globe projection and stars plugin!");
        console.log(
          "Try rotating and tilting the globe to see the stars move with it."
        );
      });

      // Controls
      const intensitySlider = document.getElementById("intensity");
      const intensityValue = document.getElementById("intensity-value");

      intensitySlider.addEventListener("input", (e) => {
        const value = parseFloat(e.target.value);
        intensityValue.textContent = value.toFixed(1);
        if (starsPlugin) {
          starsPlugin.setIntensity(value);
        }
      });
    </script>
  </body>
</html>
